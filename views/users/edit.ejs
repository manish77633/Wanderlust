<% layout("layouts/boilerplate") %>

<div class="edit-profile-page container my-5">
  <div class="row justify-content-center">
    <div class="col-12"> 
      <div class="card shadow-lg border-0 rounded-4 listing-form mx-auto p-0"> 
        
        <div class="card-header bg-primary text-white text-center rounded-top-4">
          <h3 class="my-2">Edit Profile</h3>
        </div>

        <div class="card-body p-4">
          <form
            action="/profile/edit"
            method="POST"
            enctype="multipart/form-data"
            class="needs-validation" 
            novalidate
          >
            <div class="mb-3">
              <label for="username" class="form-label fw-semibold">Username</label>
              <input
                type="text"
                class="form-control rounded-3"
                id="username"
                name="username"
                value="<%= user.username %>"
                required
              />
              <div class="invalid-feedback">Username is required.</div>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label fw-semibold">Email</label>
              <input
                type="email"
                class="form-control rounded-3"
                id="email"
                name="email"
                value="<%= user.email %>"
                required
              />
              <div class="invalid-feedback">A valid email is required.</div>
            </div>

            <div class="mb-4">
              <label for="profileImage" class="form-label fw-semibold">
                Profile Image
              </label>
              <div class="d-flex flex-column flex-md-row align-items-center gap-3">
                <img
                  src="<%= user.thumbnail %>"
                  alt="Profile Image"
                  id="imagePreview"
                  class="rounded-circle border border-2 shadow-sm profile-img-small"
                  style="object-fit: cover;"
                />
                
                <div class="w-100 w-md-auto"> 
                  <input
                    class="form-control form-control-sm"
                    type="file"
                    id="profileImage"
                    name="profileImage"
                    accept="image/*"
                    onchange="previewImage(event)"
                  />
                  <small class="text-muted">Upload a new image (optional).</small>
                </div>
              </div>
            </div>

            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-primary rounded-3 btn-lg">
                üíæ Save Changes
              </button>
            </div>

            <div class="text-center mt-3">
              <a href="/profile" class="text-decoration-none text-secondary">
                ‚Üê Back to Profile
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function () {
      const output = document.getElementById("imagePreview");
      output.src = reader.result;
    };
    if (event.target.files.length > 0) {
        reader.readAsDataURL(event.target.files[0]);
    }
  }

  (function () {
    'use strict'
    const form = document.querySelector('.needs-validation');
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false)
  })()
</script>
